<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prosody Player — Waveform</title>
  <style>
    :root{--bg:#0b0c0f;--ink:#e7e9ee;--muted:#9aa3b2;--panel:#14161a}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .card{position:relative;background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.25);overflow:hidden}
    .controls{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
    .btn{background:#0f1218;border:1px solid rgba(255,255,255,.12);color:var(--ink);border-radius:999px;padding:8px 14px;cursor:pointer}
    .pill{margin-left:auto;display:inline-block;padding:2px 8px;border-radius:999px;background:#0f1218;border:1px solid rgba(255,255,255,.12);font-size:12px;color:var(--muted)}
    #overview{height:72px}
    #detail{height:210px;border-top:1px solid rgba(255,255,255,.06)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="controls">
        <button class="btn" id="play">▶️</button>
        <button class="btn" id="pause">⏸️</button>
        <button class="btn" id="zoomOut">➖</button>
        <button class="btn" id="zoomIn">➕</button>
        <span class="pill" id="time">-- / --</span>
      </div>
      <div id="overview"></div>
      <div id="detail"></div>
    </div>
  </div>

  <script src="./wavesurfer.min.js"></script>
  <script>
  (function(){
    const qp=(k,d)=>new URLSearchParams(location.search).get(k)||d;
    const src=qp('voice','voice.mp3');

    // --- WaveSurfer: overview + detail (auto-center / zoom) ---
    const wsOverview=WaveSurfer.create({
      container:'#overview',height:72,waveColor:'#24313b',progressColor:'#435564',
      cursorColor:'transparent',barWidth:1,barGap:0,normalize:true,interact:true,dragToSeek:true,responsive:true
    });

    let pxPerSec=180; // default zoom for detail view
    const wsDetail=WaveSurfer.create({
      container:'#detail',height:210,waveColor:'#2b97ad',progressColor:'#6ae2ff',cursorColor:'#6ae2ff',
      barWidth:2,barGap:1,barRadius:1,minPxPerSec:pxPerSec,autoCenter:true,hideScrollbar:false,dragToSeek:true,
      normalize:true,responsive:true
    });

    wsOverview.load(src);
    wsDetail.load(src);

    // Controls
    const timePill=document.getElementById('time');
    document.getElementById('zoomIn').onclick = ()=>{ pxPerSec=Math.min(1200,pxPerSec*1.25); wsDetail.setOptions({minPxPerSec:pxPerSec}); };
    document.getElementById('zoomOut').onclick= ()=>{ pxPerSec=Math.max(40,  pxPerSec/1.25); wsDetail.setOptions({minPxPerSec:pxPerSec}); };
    document.getElementById('play').onclick   = ()=> wsDetail.play();
    document.getElementById('pause').onclick  = ()=> wsDetail.pause();

    function syncOverview(){
      const t=wsDetail.getCurrentTime()||0, d=wsDetail.getDuration()||1;
      if(wsOverview.setTime) wsOverview.setTime(t); else wsOverview.seekTo(t/d);
    }

    wsDetail.on('timeupdate',()=>{
      syncOverview();
      const t=wsDetail.getCurrentTime()||0, d=wsDetail.getDuration()||0;
      timePill.textContent=`${t.toFixed(2)} / ${d.toFixed(2)} s`;
    });

    wsDetail.on('seek',syncOverview);
    wsOverview.on('seek',rel=> wsDetail.seekTo(rel));
  })();
  </script>
</body>
</html>
